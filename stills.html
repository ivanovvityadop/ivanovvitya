<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stills — Victor Ivanov</title>

  <style>
    :root{
      --bg:#000;
      --fg:#f2f2f2;
      --muted:rgba(255,255,255,.6);
      --gap:16px;
      --max:1400px;
      --pad:26px;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      background:var(--bg);
      color:var(--fg);
      font-family: ui-sans-serif, system-ui;
    }

    header{
      padding:18px var(--pad);
      font-size:12px;
      opacity:.7;
    }

    header a{
      color:var(--fg);
      text-decoration:none;
    }

    .wrap{
      max-width:var(--max);
      margin:0 auto;
      padding:0 var(--pad) var(--pad);
    }

    h1{
      font-size:14px;
      letter-spacing:.08em;
      text-transform:uppercase;
      opacity:.7;
      margin:20px 0;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
      gap:var(--gap);
    }

    img{
      width:100%;
      display:block;
      background:#111;
    }

    /* upload button */
    #uploadBtn{
      position:fixed;
      bottom:16px;
      left:16px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size:11px;
      color:#ff3b3b;
      opacity:.35;
      cursor:pointer;
      user-select:none;
      display:none;
      z-index:9999;
    }

    #uploadBtn:hover{
      opacity:.9;
    }
  </style>
</head>

<body>

<header>
  <a href="index.html">← Back</a>
</header>

<div class="wrap">
  <h1>Stills</h1>
  <div class="grid" id="gallery"></div>
</div>

<!-- hidden upload -->
<input type="file" id="upload" accept="image/*" multiple hidden>
<div id="uploadBtn">[ UPLOAD STILLS ]</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
/* ================= CONFIG ================= */

const SUPABASE_URL = 'https://dlucexekstfahyhefwhz.supabase.co';
const SUPABASE_KEY = 'sb_publishable_sYXRXxUI8eY5QoUEHEpW-g_Tgg49Nmt';
const ADMIN_KEY = 'victor-admin';

const supabase = supabase.createClient(
  SUPABASE_URL,
  SUPABASE_KEY
);

const gallery = document.getElementById('gallery');
const uploadInput = document.getElementById('upload');
const uploadBtn = document.getElementById('uploadBtn');

/* ================= ADMIN VISIBILITY ================= */

if (localStorage.getItem('admin') === ADMIN_KEY) {
  uploadBtn.style.display = 'block';
}

/* ================= LOAD IMAGES ================= */

async function loadImages(){
  const { data, error } = await supabase
    .storage
    .from('stills')
    .list('', {
      limit: 100,
      sortBy: { column: 'created_at', order: 'desc' }
    });

  if (error) {
    console.error(error);
    return;
  }

  gallery.innerHTML = '';

  data.forEach(file => {
    const { data: url } = supabase
      .storage
      .from('stills')
      .getPublicUrl(file.name);

    const img = document.createElement('img');
    img.src = url.publicUrl;
    gallery.appendChild(img);
  });
}

/* ================= UPLOAD ================= */

uploadBtn.onclick = () => uploadInput.click();

uploadInput.onchange = async () => {
  const files = [...uploadInput.files];

  for (const file of files) {
    const filename = `${Date.now()}-${file.name}`;

    const { error } = await supabase
      .storage
      .from('stills')
      .upload(filename, file);

    if (error) {
      console.error(error);
    }
  }

  uploadInput.value = '';
  loadImages();
};

/* ================= INIT ================= */

loadImages();
</script>

</body>
</html>
