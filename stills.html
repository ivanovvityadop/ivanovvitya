<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Stills — Victor Ivanov</title>

<style>
:root{
  --bg:#000;
  --fg:#f2f2f2;
  --muted:rgba(255,255,255,.4);
  --gap:16px;
  --max:1400px;
  --pad:26px;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--bg);
  color:var(--fg);
  font-family:ui-sans-serif,system-ui;
}

/* header */
header{
  max-width:var(--max);
  margin:0 auto;
  padding:18px var(--pad);
  font-size:12px;
  letter-spacing:.06em;
  text-transform:uppercase;
}
header a{
  color:var(--muted);
  text-decoration:none;
}
header a:hover{color:#fff}

/* layout */
main{
  max-width:var(--max);
  margin:0 auto;
  padding:0 var(--pad) 60px;
}

h1{
  font-size:12px;
  letter-spacing:.08em;
  text-transform:uppercase;
  opacity:.6;
  margin:0 0 24px;
}

/* grid */
.grid{
  column-count:3;
  column-gap:var(--gap);
}
@media(max-width:1100px){.grid{column-count:2}}
@media(max-width:680px){.grid{column-count:1}}

.grid img{
  width:100%;
  display:block;
  margin:0 0 var(--gap);
  background:#090909;
}

/* invisible admin trigger */
#adminTrigger{
  position:fixed;
  bottom:14px;
  left:18px;
  font-size:11px;
  font-family:monospace;
  letter-spacing:.06em;
  color:#ff3b3b;
  opacity:.15;
  cursor:pointer;
  user-select:none;
}
#adminTrigger:hover{opacity:.6}

/* fully hidden input */
#fileInput{
  display:none;
}
</style>
</head>

<body>

<header>
  <a href="index.html">← Back</a>
</header>

<main>
  <h1>Stills</h1>
  <section class="grid" id="gallery"></section>
</main>

<!-- admin only -->
<div id="adminTrigger">upload stills</div>
<input id="fileInput" type="file" accept="image/jpeg,image/png" multiple>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
/* ================= CONFIG ================= */

const SUPABASE_URL = 'https://dlucexekstfahyhefwhz.supabase.co';
const SUPABASE_KEY = 'sb_publishable_sYXRXxUI8eY5QoUEHEpW-g_Tgg49Nmt';
const ADMIN_PASSWORD = 'victor-admin';
const MAX_SIZE_MB = 5;

const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
const gallery = document.getElementById('gallery');
const input = document.getElementById('fileInput');
const trigger = document.getElementById('adminTrigger');

/* ================= ADMIN AUTH ================= */

let isAdmin = false;

trigger.onclick = () => {
  const pass = prompt('password');
  if(pass === ADMIN_PASSWORD){
    isAdmin = true;
    input.click();
  }
};

/* ================= LOAD STILLS ================= */

async function loadImages(){
  const { data, error } = await supabase
    .storage.from('stills')
    .list('', { limit: 200, sortBy:{ column:'created_at', order:'desc' } });

  if(error) return;

  gallery.innerHTML = '';
  data.forEach(file=>{
    const img = document.createElement('img');
    img.src = `${SUPABASE_URL}/storage/v1/object/public/stills/${file.name}`;
    gallery.appendChild(img);
  });
}

loadImages();

/* ================= UPLOAD ================= */

input.onchange = async () => {
  if(!isAdmin) return;

  for(const file of input.files){
    if(file.size > MAX_SIZE_MB * 1024 * 1024) continue;

    const name = `${Date.now()}-${file.name}`;

    await supabase.storage
      .from('stills')
      .upload(name, file, {
        cacheControl:'3600',
        upsert:false
      });
  }

  input.value='';
  loadImages();
};
</script>

</body>
</html>
