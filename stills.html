<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Stills</title>

<style>
/* KEEP SITE STYLE – NO CUSTOM FONT */
body{
  margin:0;
  background:#000;
  color:#fff;
}

/* MATCH EXISTING SITE FEEL */
header{
  padding:16px;
  font-size:12px;
  opacity:.7;
}

header a{
  color:#fff;
  text-decoration:none;
}

.wrap{
  padding:16px;
}

h1{
  font-size:16px;
  font-weight:400;
  margin:0 0 16px 0;
}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
  gap:12px;
}

.grid img{
  width:100%;
  display:block;
  background:#111;
}

/* UPLOAD BUTTON — GREY, SAME LEVEL AS BACK */
#uploadBtn{
  position:fixed;
  bottom:16px;
  left:16px;
  padding:6px 10px;
  font-size:11px;
  color:#aaa;
  border:1px solid #333;
  background:#000;
  cursor:pointer;
  opacity:.7;
  z-index:9999;
}

#uploadBtn:hover{
  opacity:1;
}
</style>
</head>

<body>

<header>
  <a href="index.html">← Back</a>
</header>

<div class="wrap">
  <h1>Stills</h1>
  <div id="gallery" class="grid"></div>
</div>

<input type="file" id="upload" accept="image/*" multiple hidden>
<button id="uploadBtn">UPLOAD</button>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
/* ===== SUPABASE ===== */
const SUPABASE_URL = 'https://dlucexekstfahyhefwhz.supabase.co';
const SUPABASE_KEY = 'sb_publishable_sYXRXxUI8eY5QoUEHEpW-g_Tgg49Nmt';
const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* ===== ELEMENTS ===== */
const gallery = document.getElementById('gallery');
const uploadInput = document.getElementById('upload');
const uploadBtn = document.getElementById('uploadBtn');

/* ===== PASSWORD ===== */
const UPLOAD_PASSWORD = 'qwerty';
let uploadUnlocked = false;

/* ===== LOAD IMAGES ===== */
async function loadImages(){
  gallery.innerHTML = '';

  const { data, error } = await client
    .storage
    .from('stills')
    .list('', { limit:200, sortBy:{ column:'created_at', order:'desc' } });

  if (error) return;

  data.forEach(file => {
    const { data:url } = client
      .storage
      .from('stills')
      .getPublicUrl(file.name);

    if (!url?.publicUrl) return;

    const img = document.createElement('img');
    img.src = url.publicUrl;
    img.loading = 'lazy';
    gallery.appendChild(img);
  });
}

/* ===== UPLOAD FLOW ===== */
uploadBtn.onclick = () => {
  if (!uploadUnlocked){
    const pass = prompt('Password');
    if (pass !== UPLOAD_PASSWORD) return;
    uploadUnlocked = true;
  }
  uploadInput.click();
};

uploadInput.onchange = async () => {
  const files = [...uploadInput.files];

  for (const file of files){
    if (!file.type.startsWith('image/')) continue;

    const name = Date.now() + '-' + file.name;

    await client
      .storage
      .from('stills')
      .upload(name, file);
  }

  uploadInput.value = '';
  loadImages();
};

/* INIT */
loadImages();
</script>

</body>
</html>
