<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Stills</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:system-ui;
}

header{
  padding:16px;
  font-size:12px;
  opacity:.7;
}

header a{
  color:#fff;
  text-decoration:none;
}

.wrap{
  padding:16px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
  gap:12px;
}

.grid img{
  width:100%;
  display:block;
  background:#111;
}

/* UPLOAD BUTTON — ALWAYS VISIBLE */
#uploadBtn{
  position:fixed;
  bottom:16px;
  left:16px;
  padding:8px 12px;
  font-size:11px;
  color:#ff3b3b;
  border:1px solid #ff3b3b;
  background:#000;
  cursor:pointer;
  z-index:9999;
}
</style>

</head>

<body>

<header>
  <a href="index.html">← Back</a>
</header>

<div class="wrap">
  <h1>Stills</h1>
  <div id="gallery" class="grid"></div>
</div>

<input type="file" id="upload" accept="image/*" multiple hidden>
<button id="uploadBtn">UPLOAD STILLS</button>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script>
/* SUPABASE CONFIG */
const SUPABASE_URL = 'https://dlucexekstfahyhefwhz.supabase.co';
const SUPABASE_KEY = 'sb_publishable_sYXRXxUI8eY5QoUEHEpW-g_Tgg49Nmt';

const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const gallery = document.getElementById('gallery');
const uploadInput = document.getElementById('upload');
const uploadBtn = document.getElementById('uploadBtn');

/* LOAD IMAGES */
async function loadImages(){
  gallery.innerHTML = '';

  const { data, error } = await client
    .storage
    .from('stills')
    .list('', {
      limit: 200,
      sortBy:{ column:'created_at', order:'desc' }
    });

  if (error) {
    console.error(error);
    return;
  }

  data.forEach(file => {
    const { data:url } = client
      .storage
      .from('stills')
      .getPublicUrl(file.name);

    if (!url || !url.publicUrl) return;

    const img = document.createElement('img');
    img.src = url.publicUrl;
    img.loading = 'lazy';
    gallery.appendChild(img);
  });
}

/* UPLOAD */
uploadBtn.onclick = () => uploadInput.click();

uploadInput.onchange = async () => {
  const files = [...uploadInput.files];

  for (const file of files) {
    if (!file.type.startsWith('image/')) continue;

    const name = Date.now() + '-' + file.name;

    const { error } = await client
      .storage
      .from('stills')
      .upload(name, file);

    if (error) console.error(error);
  }

  uploadInput.value = '';
  loadImages();
};

/* INIT */
loadImages();
</script>

</body>
</html>
